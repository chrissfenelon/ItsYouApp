import { Difficulty } from '../../types/wordSearch.types';
import { generateAllLevels } from './generateLevels';

export interface LevelDefinition {
  id: number;
  name: string;
  difficulty: Difficulty;
  themeId: string;
  gridSize: number;
  wordCount: number;
  timeLimit: number; // in seconds
  coinReward: number;
  xpReward: number;
  unlockRequirement?: {
    level?: number;
    coins?: number;
  };
}

// Niveaux 1-60 définis manuellement pour une expérience soignée
const HANDCRAFTED_LEVELS: LevelDefinition[] = [
  // MONDE 1: DÉCOUVERTE (Levels 1-10) - Easy
  {
    id: 1,
    name: 'Premier Pas',
    difficulty: 'easy',
    themeId: 'animals',
    gridSize: 8,
    wordCount: 4,
    timeLimit: 300,
    coinReward: 10,
    xpReward: 50,
  },
  {
    id: 2,
    name: 'Petite Faim',
    difficulty: 'easy',
    themeId: 'food',
    gridSize: 8,
    wordCount: 4,
    timeLimit: 300,
    coinReward: 10,
    xpReward: 50,
  },
  {
    id: 3,
    name: 'En Mouvement',
    difficulty: 'easy',
    themeId: 'sports',
    gridSize: 8,
    wordCount: 5,
    timeLimit: 300,
    coinReward: 12,
    xpReward: 60,
  },
  {
    id: 4,
    name: 'Zoo Miniature',
    difficulty: 'easy',
    themeId: 'animals',
    gridSize: 8,
    wordCount: 5,
    timeLimit: 300,
    coinReward: 12,
    xpReward: 60,
  },
  {
    id: 5,
    name: 'Arc-en-Ciel',
    difficulty: 'easy',
    themeId: 'colors',
    gridSize: 8,
    wordCount: 5,
    timeLimit: 300,
    coinReward: 15,
    xpReward: 70,
    unlockRequirement: { coins: 50 },
  },
  {
    id: 6,
    name: 'Chef Débutant',
    difficulty: 'easy',
    themeId: 'food',
    gridSize: 9,
    wordCount: 5,
    timeLimit: 330,
    coinReward: 15,
    xpReward: 70,
  },
  {
    id: 7,
    name: 'Forêt Enchantée',
    difficulty: 'easy',
    themeId: 'nature',
    gridSize: 9,
    wordCount: 5,
    timeLimit: 330,
    coinReward: 15,
    xpReward: 70,
    unlockRequirement: { coins: 100 },
  },
  {
    id: 8,
    name: 'Jeux Olympiques',
    difficulty: 'easy',
    themeId: 'sports',
    gridSize: 9,
    wordCount: 6,
    timeLimit: 330,
    coinReward: 18,
    xpReward: 80,
  },
  {
    id: 9,
    name: 'Safari Photo',
    difficulty: 'easy',
    themeId: 'animals',
    gridSize: 9,
    wordCount: 6,
    timeLimit: 330,
    coinReward: 18,
    xpReward: 80,
  },
  {
    id: 10,
    name: 'Palette de Peintre',
    difficulty: 'easy',
    themeId: 'colors',
    gridSize: 9,
    wordCount: 6,
    timeLimit: 360,
    coinReward: 20,
    xpReward: 90,
  },

  // MONDE 2: AVENTURE (Levels 11-25) - Medium
  {
    id: 11,
    name: 'Voyage Commence',
    difficulty: 'medium',
    themeId: 'travel',
    gridSize: 10,
    wordCount: 6,
    timeLimit: 420,
    coinReward: 25,
    xpReward: 100,
    unlockRequirement: { level: 10, coins: 150 },
  },
  {
    id: 12,
    name: 'Menu Gastronomique',
    difficulty: 'medium',
    themeId: 'food',
    gridSize: 10,
    wordCount: 6,
    timeLimit: 420,
    coinReward: 25,
    xpReward: 100,
  },
  {
    id: 13,
    name: 'Concert Rock',
    difficulty: 'medium',
    themeId: 'music',
    gridSize: 10,
    wordCount: 7,
    timeLimit: 420,
    coinReward: 28,
    xpReward: 110,
    unlockRequirement: { coins: 100 },
  },
  {
    id: 14,
    name: 'Jungle Tropicale',
    difficulty: 'medium',
    themeId: 'animals',
    gridSize: 10,
    wordCount: 7,
    timeLimit: 450,
    coinReward: 28,
    xpReward: 110,
  },
  {
    id: 15,
    name: 'Silicon Valley',
    difficulty: 'medium',
    themeId: 'technology',
    gridSize: 10,
    wordCount: 7,
    timeLimit: 450,
    coinReward: 30,
    xpReward: 120,
    unlockRequirement: { coins: 100 },
  },
  {
    id: 16,
    name: 'Stade Olympique',
    difficulty: 'medium',
    themeId: 'sports',
    gridSize: 11,
    wordCount: 7,
    timeLimit: 450,
    coinReward: 30,
    xpReward: 120,
  },
  {
    id: 17,
    name: 'Jardin Botanique',
    difficulty: 'medium',
    themeId: 'nature',
    gridSize: 11,
    wordCount: 8,
    timeLimit: 480,
    coinReward: 32,
    xpReward: 130,
  },
  {
    id: 18,
    name: 'Métiers du Monde',
    difficulty: 'medium',
    themeId: 'professions',
    gridSize: 11,
    wordCount: 8,
    timeLimit: 480,
    coinReward: 32,
    xpReward: 130,
    unlockRequirement: { coins: 150 },
  },
  {
    id: 19,
    name: 'Tour du Monde',
    difficulty: 'medium',
    themeId: 'travel',
    gridSize: 11,
    wordCount: 8,
    timeLimit: 480,
    coinReward: 35,
    xpReward: 140,
  },
  {
    id: 20,
    name: 'Festival Musical',
    difficulty: 'medium',
    themeId: 'music',
    gridSize: 11,
    wordCount: 8,
    timeLimit: 510,
    coinReward: 35,
    xpReward: 140,
  },
  {
    id: 21,
    name: 'Restaurant Étoilé',
    difficulty: 'medium',
    themeId: 'food',
    gridSize: 12,
    wordCount: 9,
    timeLimit: 510,
    coinReward: 38,
    xpReward: 150,
  },
  {
    id: 22,
    name: 'Cyber Espace',
    difficulty: 'medium',
    themeId: 'technology',
    gridSize: 12,
    wordCount: 9,
    timeLimit: 510,
    coinReward: 38,
    xpReward: 150,
  },
  {
    id: 23,
    name: 'Savane Africaine',
    difficulty: 'medium',
    themeId: 'animals',
    gridSize: 12,
    wordCount: 9,
    timeLimit: 540,
    coinReward: 40,
    xpReward: 160,
  },
  {
    id: 24,
    name: 'Spectre Coloré',
    difficulty: 'medium',
    themeId: 'colors',
    gridSize: 12,
    wordCount: 9,
    timeLimit: 540,
    coinReward: 40,
    xpReward: 160,
  },
  {
    id: 25,
    name: 'Champions du Sport',
    difficulty: 'medium',
    themeId: 'sports',
    gridSize: 12,
    wordCount: 10,
    timeLimit: 540,
    coinReward: 45,
    xpReward: 170,
  },

  // MONDE 3: DÉFI (Levels 26-40) - Hard
  {
    id: 26,
    name: 'Défi Accepté',
    difficulty: 'hard',
    themeId: 'professions',
    gridSize: 12,
    wordCount: 9,
    timeLimit: 600,
    coinReward: 50,
    xpReward: 200,
    unlockRequirement: { level: 25, coins: 300 },
  },
  {
    id: 27,
    name: 'Grande Aventure',
    difficulty: 'hard',
    themeId: 'travel',
    gridSize: 12,
    wordCount: 9,
    timeLimit: 600,
    coinReward: 50,
    xpReward: 200,
  },
  {
    id: 28,
    name: 'Symphonie Parfaite',
    difficulty: 'hard',
    themeId: 'music',
    gridSize: 13,
    wordCount: 10,
    timeLimit: 630,
    coinReward: 55,
    xpReward: 210,
  },
  {
    id: 29,
    name: 'Océan Profond',
    difficulty: 'hard',
    themeId: 'animals',
    gridSize: 13,
    wordCount: 10,
    timeLimit: 630,
    coinReward: 55,
    xpReward: 210,
  },
  {
    id: 30,
    name: 'Innovation Technologique',
    difficulty: 'hard',
    themeId: 'technology',
    gridSize: 13,
    wordCount: 10,
    timeLimit: 660,
    coinReward: 60,
    xpReward: 220,
  },
  {
    id: 31,
    name: 'Banquet Royal',
    difficulty: 'hard',
    themeId: 'food',
    gridSize: 13,
    wordCount: 11,
    timeLimit: 660,
    coinReward: 60,
    xpReward: 220,
  },
  {
    id: 32,
    name: 'Forêt Amazonienne',
    difficulty: 'hard',
    themeId: 'nature',
    gridSize: 14,
    wordCount: 11,
    timeLimit: 690,
    coinReward: 65,
    xpReward: 230,
  },
  {
    id: 33,
    name: 'Carrières Prestigieuses',
    difficulty: 'hard',
    themeId: 'professions',
    gridSize: 14,
    wordCount: 11,
    timeLimit: 690,
    coinReward: 65,
    xpReward: 230,
  },
  {
    id: 34,
    name: 'Compétition Mondiale',
    difficulty: 'hard',
    themeId: 'sports',
    gridSize: 14,
    wordCount: 12,
    timeLimit: 720,
    coinReward: 70,
    xpReward: 240,
  },
  {
    id: 35,
    name: 'Palette Complète',
    difficulty: 'hard',
    themeId: 'colors',
    gridSize: 14,
    wordCount: 12,
    timeLimit: 720,
    coinReward: 70,
    xpReward: 240,
  },
  {
    id: 36,
    name: 'Destinations Exotiques',
    difficulty: 'hard',
    themeId: 'travel',
    gridSize: 14,
    wordCount: 12,
    timeLimit: 750,
    coinReward: 75,
    xpReward: 250,
  },
  {
    id: 37,
    name: 'Opéra Classique',
    difficulty: 'hard',
    themeId: 'music',
    gridSize: 14,
    wordCount: 13,
    timeLimit: 750,
    coinReward: 75,
    xpReward: 250,
  },
  {
    id: 38,
    name: 'Règne Animal',
    difficulty: 'hard',
    themeId: 'animals',
    gridSize: 15,
    wordCount: 13,
    timeLimit: 780,
    coinReward: 80,
    xpReward: 260,
  },
  {
    id: 39,
    name: 'Révolution Numérique',
    difficulty: 'hard',
    themeId: 'technology',
    gridSize: 15,
    wordCount: 13,
    timeLimit: 780,
    coinReward: 80,
    xpReward: 260,
  },
  {
    id: 40,
    name: 'Cuisine du Monde',
    difficulty: 'hard',
    themeId: 'food',
    gridSize: 15,
    wordCount: 14,
    timeLimit: 810,
    coinReward: 85,
    xpReward: 270,
  },

  // MONDE 4: MAÎTRE (Levels 41-60) - Expert
  {
    id: 41,
    name: 'Ascension du Maître',
    difficulty: 'expert',
    themeId: 'nature',
    gridSize: 15,
    wordCount: 13,
    timeLimit: 900,
    coinReward: 100,
    xpReward: 400,
    unlockRequirement: { level: 40, coins: 500 },
  },
  {
    id: 42,
    name: 'Elite Professionnelle',
    difficulty: 'expert',
    themeId: 'professions',
    gridSize: 15,
    wordCount: 14,
    timeLimit: 900,
    coinReward: 105,
    xpReward: 410,
  },
  {
    id: 43,
    name: 'Légendes du Sport',
    difficulty: 'expert',
    themeId: 'sports',
    gridSize: 16,
    wordCount: 14,
    timeLimit: 930,
    coinReward: 110,
    xpReward: 420,
  },
  {
    id: 44,
    name: 'Atlas Mondial',
    difficulty: 'expert',
    themeId: 'travel',
    gridSize: 16,
    wordCount: 14,
    timeLimit: 930,
    coinReward: 110,
    xpReward: 420,
  },
  {
    id: 45,
    name: 'Maestro Musical',
    difficulty: 'expert',
    themeId: 'music',
    gridSize: 16,
    wordCount: 15,
    timeLimit: 960,
    coinReward: 115,
    xpReward: 430,
  },
  {
    id: 46,
    name: 'Faune Mondiale',
    difficulty: 'expert',
    themeId: 'animals',
    gridSize: 16,
    wordCount: 15,
    timeLimit: 960,
    coinReward: 115,
    xpReward: 430,
  },
  {
    id: 47,
    name: 'Génie Technologique',
    difficulty: 'expert',
    themeId: 'technology',
    gridSize: 17,
    wordCount: 15,
    timeLimit: 990,
    coinReward: 120,
    xpReward: 440,
  },
  {
    id: 48,
    name: 'Chef Étoilé Michelin',
    difficulty: 'expert',
    themeId: 'food',
    gridSize: 17,
    wordCount: 16,
    timeLimit: 990,
    coinReward: 125,
    xpReward: 450,
  },
  {
    id: 49,
    name: 'Nuancier Expert',
    difficulty: 'expert',
    themeId: 'colors',
    gridSize: 17,
    wordCount: 16,
    timeLimit: 1020,
    coinReward: 130,
    xpReward: 460,
  },
  {
    id: 50,
    name: 'Biodiversité Suprême',
    difficulty: 'expert',
    themeId: 'nature',
    gridSize: 17,
    wordCount: 17,
    timeLimit: 1050,
    coinReward: 135,
    xpReward: 470,
  },
  {
    id: 51,
    name: 'Sommets Professionnels',
    difficulty: 'expert',
    themeId: 'professions',
    gridSize: 18,
    wordCount: 17,
    timeLimit: 1080,
    coinReward: 140,
    xpReward: 480,
  },
  {
    id: 52,
    name: 'Jeux du Siècle',
    difficulty: 'expert',
    themeId: 'sports',
    gridSize: 18,
    wordCount: 17,
    timeLimit: 1080,
    coinReward: 140,
    xpReward: 480,
  },
  {
    id: 53,
    name: 'Explorateur Mondial',
    difficulty: 'expert',
    themeId: 'travel',
    gridSize: 18,
    wordCount: 18,
    timeLimit: 1110,
    coinReward: 145,
    xpReward: 490,
  },
  {
    id: 54,
    name: 'Concerto Virtuose',
    difficulty: 'expert',
    themeId: 'music',
    gridSize: 18,
    wordCount: 18,
    timeLimit: 1110,
    coinReward: 145,
    xpReward: 490,
  },
  {
    id: 55,
    name: 'Biodôme Complet',
    difficulty: 'expert',
    themeId: 'animals',
    gridSize: 19,
    wordCount: 18,
    timeLimit: 1140,
    coinReward: 150,
    xpReward: 500,
  },
  {
    id: 56,
    name: 'Intelligence Artificielle',
    difficulty: 'expert',
    themeId: 'technology',
    gridSize: 19,
    wordCount: 19,
    timeLimit: 1170,
    coinReward: 155,
    xpReward: 510,
  },
  {
    id: 57,
    name: 'Haute Gastronomie',
    difficulty: 'expert',
    themeId: 'food',
    gridSize: 19,
    wordCount: 19,
    timeLimit: 1170,
    coinReward: 160,
    xpReward: 520,
  },
  {
    id: 58,
    name: 'Prisme Chromatique',
    difficulty: 'expert',
    themeId: 'colors',
    gridSize: 19,
    wordCount: 20,
    timeLimit: 1200,
    coinReward: 165,
    xpReward: 530,
  },
  {
    id: 59,
    name: 'Paradis Naturel',
    difficulty: 'expert',
    themeId: 'nature',
    gridSize: 20,
    wordCount: 20,
    timeLimit: 1200,
    coinReward: 170,
    xpReward: 540,
  },
  {
    id: 60,
    name: 'Légende Absolue',
    difficulty: 'expert',
    themeId: 'professions',
    gridSize: 20,
    wordCount: 22,
    timeLimit: 1500,
    coinReward: 200,
    xpReward: 600,
  },
];

// Générer les niveaux 61-300
const GENERATED_LEVELS = generateAllLevels();

// Combiner tous les niveaux
export const LEVELS: LevelDefinition[] = [
  ...HANDCRAFTED_LEVELS,
  ...GENERATED_LEVELS,
];

export const getLevelById = (id: number): LevelDefinition | undefined => {
  return LEVELS.find(level => level.id === id);
};

export const getLevelsByDifficulty = (difficulty: Difficulty): LevelDefinition[] => {
  return LEVELS.filter(level => level.difficulty === difficulty);
};

export const getLevelsByTheme = (themeId: string): LevelDefinition[] => {
  return LEVELS.filter(level => level.themeId === themeId);
};

export const getNextLevel = (currentLevel: number): LevelDefinition | undefined => {
  return LEVELS.find(level => level.id === currentLevel + 1);
};

export const isLevelUnlocked = (
  levelId: number,
  completedLevels: number[],
  currentCoins: number
): boolean => {
  const level = getLevelById(levelId);
  if (!level) return false;

  // First level is always unlocked
  if (levelId === 1) return true;

  // Check level requirement
  if (level.unlockRequirement?.level) {
    if (!completedLevels.includes(level.unlockRequirement.level)) {
      return false;
    }
  }

  // Check coin requirement
  if (level.unlockRequirement?.coins) {
    if (currentCoins < level.unlockRequirement.coins) {
      return false;
    }
  }

  // Check previous level is completed (default requirement)
  if (!level.unlockRequirement) {
    const previousLevel = levelId - 1;
    if (previousLevel > 0 && !completedLevels.includes(previousLevel)) {
      return false;
    }
  }

  return true;
};
